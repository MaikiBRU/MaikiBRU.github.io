const translations = {
  es: {
    nav_about: "Sobre mi",
    nav_services: "Servicios",
    nav_process: "Proceso",
    nav_skills: "Habilidades",
    nav_projects: "Proyectos",
    nav_experience: "Experiencia",
    nav_education: "Educacion",
    nav_notes: "Notas",
    nav_contact: "Contacto",
    nav_cta: "Hablemos",
    hero_eyebrow: "Portfolio profesional",
    hero_title: "Aaron Brumat <span>Full Stack Junior</span>",
    hero_sub: "Disponible full time para contrataciones en empresa y tambien para proyectos freelance. Como disenador web trabajo en modalidad freelance.",
    hero_cta_freelance: "Proyecto freelance",
    hero_cta_primary: "Ver proyectos",
    hero_cta_secondary: "Contactar",
    hero_cta_cv: "Ver CV",
    hero_response: "Respuesta en 24-48h.",
    hero_meta_1_label: "Enfoque",
    hero_meta_1_value: "Calidad y detalle",
    hero_meta_2_label: "Trabajo",
    hero_meta_2_value: "Remoto o hibrido",
    hero_meta_3_label: "Disponibilidad",
    hero_meta_3_value: "Full time + freelance",
    profile_title: "Perfil",
    profile_name: "Aaron Brumat",
    profile_status: "Disponible",
    profile_body: "Software Engineer Junior con disponibilidad full time para empresa y freelance. En diseño web trabajo como freelancer.",
    profile_tag_1: "Web",
    profile_tag_2: "Diseño web",
    profile_tag_3: "UI/UX",
    profile_cta: "Agendar llamada",
    profile_cta_secondary: "Explorar",
    about_eyebrow: "Sobre mi",
    about_title: "Construyo experiencias digitales con impacto real",
    about_text: "Soy estudiante del ultimo año de Desarrollo de Software en el Instituto Belgrano (Rosario). Tengo disponibilidad full time para contrataciones en empresa y tambien acepto proyectos freelance. En diseño web trabajo como freelancer, con foco en construir productos claros, eficientes y escalables.",
    about_card_1_title: "Filosofia",
    about_card_1_text: "Diseño sistemas simples que pueden crecer sin perder claridad ni estabilidad.",
    about_card_2_title: "Metodologia",
    about_card_2_text: "Iteracion rapida, validacion constante y entrega con estandares profesionales.",
    about_card_3_title: "Valores",
    about_card_3_text: "Transparencia, ownership y una comunicacion clara en cada etapa del proyecto.",
    services_eyebrow: "Servicios",
    services_title: "Soluciones completas para productos digitales",
    services_text: "Como perfil junior, me enfoco en entregar soluciones claras, con buenas practicas y compromiso de aprendizaje continuo.",
    services_card_1_title: "Desarrollo web",
    services_card_1_text: "Landing o web completa, responsive, performance y deploy.",
    services_card_2_title: "Diseño web",
    services_card_2_text: "Diseño visual, estructura clara y UI consistente para web.",
    services_card_3_title: "Automatizacion",
    services_card_3_text: "Scripts, reportes y automatizaciones para ahorrar tiempo.",
    process_eyebrow: "Proceso",
    process_title: "Como trabajo en cada proyecto",
    process_text: "Un flujo simple, claro y enfocado en resultados.",
    process_1_title: "1. Descubrimiento",
    process_1_text: "Objetivos, alcance y prioridades definidas desde el inicio.",
    process_2_title: "2. Diseño y desarrollo",
    process_2_text: "Iteracion rapida con foco en claridad visual y funcional.",
    process_3_title: "3. Entrega y mejora",
    process_3_text: "Entrega con testing basico y ajustes segun feedback.",
    skills_eyebrow: "Habilidades",
    skills_title: "Tecnologias y herramientas principales",
    skills_text: "Tecnologias aprendidas durante mi formacion.",
    skills_block_1_title: "Lenguajes",
    skills_block_1_list: "Python, C#, JavaScript",
    skills_block_2_title: "Bases de datos",
    skills_block_2_list: "MySQL Workbench",
    skills_block_3_title: "Herramientas",
    skills_block_3_list: "MySQL Workbench",
    skills_block_4_title: "Herramientas actuales",
    skills_block_4_list: "VS Code, MySQL Workbench",
    skills_block_5_title: "Aprendiendo",
    skills_block_5_list: "Haskell, desarrollo de videojuegos en Unity, frameworks Django, Flask y FastAPI.",
    projects_eyebrow: "Proyectos",
    projects_title: "Trabajo seleccionado",
    projects_text: "Prefiero enfocarme en un proyecto grande y bien hecho antes que en varios proyectos pequeños.",
    project_1_title: "StockARG",
    project_1_tag: "Finanzas",
    project_1_text: "Centraliza clientes, productos, ventas y stock en un solo sistema. Interfaz clara en Tkinter y reportes exportables. Desarrollado en 2 semanas.",
    project_1_feature_1: "Login con email/contrasena y opcion Google (opcional).",
    project_1_feature_2: "ABM de clientes, proveedores y productos.",
    project_1_feature_3: "Ventas con control de stock y reportes exportables.",
    project_1_feature_4: "Modulo de stock con alertas, movimientos y panel de estado.",
    project_1_stack_1: "Python",
    project_1_stack_2: "Tkinter",
    project_1_stack_3: "MySQL",
    project_1_stack_4: "2 semanas",
    project_btn_code: "Ver codigo",
    case_eyebrow: "Caso de estudio",
    case_title: "StockARG en 2 semanas",
    case_intro: "Proyecto individual para centralizar clientes, productos, stock y ventas en un solo sistema.",
    case_1_title: "Problema",
    case_1_text: "Gestion dispersa de clientes, stock y ventas sin reportes claros.",
    case_2_title: "Solucion",
    case_2_text: "App de escritorio en Python + Tkinter + MySQL con login y modulos clave.",
    case_3_title: "Resultados",
    case_3_item_1: "Flujos completos de ventas y stock con reportes.",
    case_3_item_2: "Exportacion a CSV/PDF y panel de estado.",
    case_3_item_3: "UI consistente y facil de usar.",
    case_tag_1: "Proyecto individual",
    case_tag_2: "2 semanas",
    experience_eyebrow: "Experiencia",
    experience_title: "Trayectoria profesional",
    experience_text: "Experiencia laboral convencional con foco en procesos, datos y atencion al cliente. Busco mi primera experiencia IT y aportar responsabilidad, puntualidad y trabajo en equipo.",
    exp_1_title: "Vendedor y atencion al cliente",
    exp_1_company: "Local de Ropa 'KINGU' | 03/2025 - 11/2025",
    exp_1_text: "Atencion al cliente, manejo de caja y cierres. Orden operativo, puntualidad y trabajo en equipo.",
    exp_2_title: "Vendedor y control de stock",
    exp_2_company: "Almacen 'Tina' | 02/2024 - 12/2024",
    exp_2_text: "Control de stock y registro de mercaderia. Orden, responsabilidad y consistencia diaria.",
    exp_3_title: "Pasantia administrativa",
    exp_3_company: "S.I.S.O SRL | 11/2023 - 12/2023",
    exp_3_text: "Carga y correccion de datos en software contable. Cumplimiento de procesos y atencion al detalle.",
    experience_transfer_title: "Transferencias a IT",
    experience_transfer_item_1: "Procesos y orden",
    experience_transfer_item_2: "Calidad de datos y registros",
    experience_transfer_item_3: "Trabajo en equipo y atencion al detalle",
        education_eyebrow: "Educacion",
    education_title: "Formacion",
    education_text: "Estudiante en el ultimo año de Desarrollo de Software.",
    edu_1_title: "Desarrollo de Software",
    edu_1_place: "Instituto Belgrano, Rosario | Ultimo año",
    edu_1_text: "Formacion tecnica con foco en desarrollo y buenas practicas.",
    edu_2_title: "En formacion continua",
    edu_2_place: "Cursos y practicas personales",
    edu_2_text: "Refuerzo constante en lenguajes y herramientas.",
    edu_3_title: "Aprendizaje autodidacta",
    edu_3_place: "Proyectos personales",
    edu_3_text: "Aplicacion de conceptos en proyectos reales.",
    testimonials_eyebrow: "Referencias",
    testimonials_title: "Referencias disponibles",
    testimonials_text: "Referencias disponibles a pedido.",
    test_ref_text: "Referencias disponibles a pedido.",
    notes_eyebrow: "Notas",
    notes_title: "Ideas, procesos y aprendizajes",
    notes_text: "Espacio para compartir insights sobre tecnologia y producto.",
    note_1_title: "Como optimizar un flujo de trabajo",
    note_1_text: "Guia breve sobre automatizacion y productividad.",
    note_2_title: "Checklist para lanzar un producto",
    note_2_text: "Puntos clave para asegurar calidad y coherencia.",
    note_3_title: "UI moderna sin perder performance",
    note_3_text: "Equilibrio entre estetica y velocidad de carga.",
    contact_eyebrow: "Contacto",
    contact_title: "Trabajemos juntos",
    contact_text: "Contame sobre tu idea y te respondo con una propuesta clara.",
    contact_email_label: "Email",
    contact_call_label: "Agendar llamada",
    contact_call_cta: "Abrir WhatsApp",
    contact_availability_label: "Disponibilidad",
    contact_availability_text: "Full time en empresa + proyectos freelance. Diseño web siempre freelance.",
    contact_response_label: "Tiempo de respuesta",
    contact_response_text: "Respondo en 24-48h.",
    contact_linkedin_label: "LinkedIn",
    contact_github_label: "GitHub",
    form_name: "Nombre",
    form_email: "Email",
    form_message: "Mensaje",
    form_submit: "Enviar mensaje",
    form_disclaimer: "Se abrira un selector para Gmail o Outlook con el mensaje listo.",
    mail_picker_title: "Elegi como enviar",
    mail_picker_text: "Podes abrir Gmail o Outlook Web con el mensaje listo.",
    mail_picker_gmail: "Abrir Gmail",
    mail_picker_outlook: "Abrir Outlook",
    mail_picker_copy: "Copiar mensaje",
    mail_picker_note: "Si usas un cliente local, copia el mensaje y pegalo.",
    form_name_placeholder: "Tu nombre",
    form_email_placeholder: "tucorreo@email.com",
    form_message_placeholder: "Contame sobre tu proyecto",
    footer_text: "Desarrollador de software - Portfolio 2026",
    footer_back: "Volver arriba",
    mail_subject: "Contacto desde portfolio",
    mail_body_name: "Nombre",
    mail_body_email: "Email",
    mail_body_message: "Mensaje"
  },
  en: {
    nav_about: "About",
    nav_services: "Services",
    nav_process: "Process",
    nav_skills: "Skills",
    nav_projects: "Projects",
    nav_experience: "Experience",
    nav_education: "Education",
    nav_notes: "Notes",
    nav_contact: "Contact",
    nav_cta: "Let us talk",
    hero_eyebrow: "Professional portfolio",
    hero_title: "Aaron Brumat <span>Junior Full Stack</span>",
    hero_sub: "Available full time for company roles and also for freelance projects. As a web designer, I work freelance.",
    hero_cta_freelance: "Freelance project",
    hero_cta_primary: "View projects",
    hero_cta_secondary: "Contact",
    hero_cta_cv: "View CV",
    hero_response: "Reply within 24-48h.",
    hero_meta_1_label: "Focus",
    hero_meta_1_value: "Quality and detail",
    hero_meta_2_label: "Work",
    hero_meta_2_value: "Remote or hybrid",
    hero_meta_3_label: "Availability",
    hero_meta_3_value: "Full time + freelance",
    profile_title: "Profile",
    profile_name: "Aaron Brumat",
    profile_status: "Available",
    profile_body: "Junior Software Engineer available full time for companies and freelance. As a web designer, I work freelance.",
    profile_tag_1: "Web",
    profile_tag_2: "Web design",
    profile_tag_3: "UI/UX",
    profile_cta: "Schedule a call",
    profile_cta_secondary: "Explore",
    about_eyebrow: "About",
    about_title: "I build digital experiences with real impact",
    about_text: "I am a final-year Software Development student at Instituto Belgrano (Rosario). I am available full time for company roles and also take freelance projects. As a web designer, I work freelance, focused on building clear, efficient, and scalable products.",
    about_card_1_title: "Philosophy",
    about_card_1_text: "I design simple systems that can grow without losing clarity or stability.",
    about_card_2_title: "Method",
    about_card_2_text: "Fast iteration, constant validation, and delivery with professional standards.",
    about_card_3_title: "Values",
    about_card_3_text: "Transparency, ownership, and clear communication at every stage.",
    services_eyebrow: "Services",
    services_title: "Complete solutions for digital products",
    services_text: "As a junior profile, I focus on delivering clear solutions with good practices and continuous learning.",
    services_card_1_title: "Web development",
    services_card_1_text: "Landing or full website, responsive, performance, and deploy.",
    services_card_2_title: "Web design",
    services_card_2_text: "Visual design, clear structure, and consistent UI for the web.",
    services_card_3_title: "Automation",
    services_card_3_text: "Scripts, reports, and automations to save time.",
    process_eyebrow: "Process",
    process_title: "How I work on each project",
    process_text: "A simple, clear flow focused on results.",
    process_1_title: "1. Discovery",
    process_1_text: "Goals, scope, and priorities defined from day one.",
    process_2_title: "2. Design and build",
    process_2_text: "Fast iteration focused on visual clarity and function.",
    process_3_title: "3. Delivery and improve",
    process_3_text: "Delivery with basic testing and adjustments from feedback.",
    skills_eyebrow: "Skills",
    skills_title: "Core technologies and tools",
    skills_text: "Technologies learned during my training.",
    skills_block_1_title: "Languages",
    skills_block_1_list: "Python, C#, JavaScript",
    skills_block_2_title: "Databases",
    skills_block_2_list: "MySQL Workbench",
    skills_block_3_title: "Tools",
    skills_block_3_list: "MySQL Workbench",
    skills_block_4_title: "Current tools",
    skills_block_4_list: "VS Code, MySQL Workbench",
    skills_block_5_title: "Learning",
    skills_block_5_list: "Haskell, game development in Unity, frameworks Django, Flask, and FastAPI.",
    projects_eyebrow: "Projects",
    projects_title: "Selected work",
    projects_text: "I prefer to focus on one solid, well-built project rather than many small ones.",
    project_1_title: "StockARG",
    project_1_tag: "Finance",
    project_1_text: "Centralizes customers, products, sales, and stock in one system. Clear Tkinter UI with exportable reports. Built in 2 weeks.",
    project_1_feature_1: "Email/password login with optional Google sign-in.",
    project_1_feature_2: "CRUD for customers, suppliers, and products.",
    project_1_feature_3: "Sales with stock control and exportable reports.",
    project_1_feature_4: "Stock module with alerts, movements, and status panel.",
    project_1_stack_1: "Python",
    project_1_stack_2: "Tkinter",
    project_1_stack_3: "MySQL",
    project_1_stack_4: "2 weeks",
    project_btn_code: "View code",
    case_eyebrow: "Case study",
    case_title: "StockARG in 2 weeks",
    case_intro: "Solo project to centralize customers, products, stock, and sales in one system.",
    case_1_title: "Problem",
    case_1_text: "Scattered customer, stock, and sales management with no clear reports.",
    case_2_title: "Solution",
    case_2_text: "Desktop app in Python + Tkinter + MySQL with login and key modules.",
    case_3_title: "Results",
    case_3_item_1: "Complete sales and stock flows with reports.",
    case_3_item_2: "CSV/PDF export and system status panel.",
    case_3_item_3: "Consistent, easy-to-use UI.",
    case_tag_1: "Solo project",
    case_tag_2: "2 weeks",
    experience_eyebrow: "Experience",
    experience_title: "Professional journey",
    experience_text: "Conventional work experience focused on processes, data, and customer service. Seeking my first IT role and bringing responsibility, punctuality, and teamwork.",
    exp_1_title: "Sales and customer service",
    exp_1_company: "KINGU Clothing Store | 03/2025 - 11/2025",
    exp_1_text: "Customer service, cash handling, and closing. Operational order, punctuality, and teamwork.",
    exp_2_title: "Sales and stock control",
    exp_2_company: "Tina Grocery Store | 02/2024 - 12/2024",
    exp_2_text: "Stock control and inventory records. Order, responsibility, and daily consistency.",
    exp_3_title: "Administrative internship",
    exp_3_company: "S.I.S.O SRL | 11/2023 - 12/2023",
    exp_3_text: "Data entry and corrections in accounting software. Process compliance and attention to detail.",
    experience_transfer_title: "Transferable skills to IT",
    experience_transfer_item_1: "Processes and order",
    experience_transfer_item_2: "Data quality and records",
    experience_transfer_item_3: "Teamwork and attention to detail",
        education_eyebrow: "Education",
    education_title: "Training",
    education_text: "Final-year Software Development student.",
    edu_1_title: "Software Development",
    edu_1_place: "Instituto Belgrano, Rosario | Final year",
    edu_1_text: "Technical training focused on development and best practices.",
    edu_2_title: "Continuous training",
    edu_2_place: "Courses and personal practice",
    edu_2_text: "Constant reinforcement of languages and tools.",
    edu_3_title: "Self-learning",
    edu_3_place: "Personal projects",
    edu_3_text: "Applying concepts in real projects.",
    testimonials_eyebrow: "References",
    testimonials_title: "References available",
    testimonials_text: "References available upon request.",
    test_ref_text: "References available upon request.",
    notes_eyebrow: "Notes",
    notes_title: "Ideas, processes, and learnings",
    notes_text: "A place to share insights about technology and product.",
    note_1_title: "How to optimize a workflow",
    note_1_text: "A short guide on automation and productivity.",
    note_2_title: "Product launch checklist",
    note_2_text: "Key points to ensure quality and consistency.",
    note_3_title: "Modern UI without losing performance",
    note_3_text: "Balance between aesthetics and load speed.",
    contact_eyebrow: "Contact",
    contact_title: "Let us work together",
    contact_text: "Tell me about your idea and I will respond with a clear proposal.",
    contact_email_label: "Email",
    contact_call_label: "Schedule a call",
    contact_call_cta: "Open WhatsApp",
    contact_availability_label: "Availability",
    contact_availability_text: "Full time for company roles + freelance projects. Web design is always freelance.",
    contact_response_label: "Response time",
    contact_response_text: "Reply within 24-48h.",
    contact_linkedin_label: "LinkedIn",
    contact_github_label: "GitHub",
    form_name: "Name",
    form_email: "Email",
    form_message: "Message",
    form_submit: "Send message",
    form_disclaimer: "A chooser will open for Gmail or Outlook with the message ready.",
    mail_picker_title: "Choose how to send",
    mail_picker_text: "Open Gmail or Outlook Web with the message ready.",
    mail_picker_gmail: "Open Gmail",
    mail_picker_outlook: "Open Outlook",
    mail_picker_copy: "Copy message",
    mail_picker_note: "If you use a local mail app, copy and paste the message.",
    form_name_placeholder: "Your name",
    form_email_placeholder: "yourmail@email.com",
    form_message_placeholder: "Tell me about your project",
    footer_text: "Software developer - Portfolio 2026",
    footer_back: "Back to top",
    mail_subject: "Portfolio contact",
    mail_body_name: "Name",
    mail_body_email: "Email",
    mail_body_message: "Message"
  }
};

const langToggle = document.getElementById("lang-toggle");
let currentLang = localStorage.getItem("portfolio_lang") || "es";

const setLanguage = (lang) => {
  currentLang = lang;
  localStorage.setItem("portfolio_lang", lang);
  document.documentElement.lang = lang;
  langToggle.textContent = lang === "es" ? "EN" : "ES";

  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.dataset.i18n;
    if (translations[lang][key]) {
      el.textContent = translations[lang][key];
    }
  });

  document.querySelectorAll("[data-i18n-html]").forEach((el) => {
    const key = el.dataset.i18nHtml;
    if (translations[lang][key]) {
      el.innerHTML = translations[lang][key];
    }
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
    const key = el.dataset.i18nPlaceholder;
    if (translations[lang][key]) {
      el.setAttribute("placeholder", translations[lang][key]);
    }
  });
};

langToggle.addEventListener("click", () => {
  const next = currentLang === "es" ? "en" : "es";
  setLanguage(next);
});

setLanguage(currentLang);

const revealElements = document.querySelectorAll("[data-reveal]");
revealElements.forEach((el) => el.classList.add("reveal"));

const observer = new IntersectionObserver(
  (entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add("visible");
        observer.unobserve(entry.target);
      }
    });
  },
  { threshold: 0.2 }
);

revealElements.forEach((el) => observer.observe(el));

const contactForm = document.getElementById("contact-form");
const mailPicker = document.getElementById("mail-picker");
const mailLink = document.querySelector("[data-mail-link]");
let mailData = { to: "aaronbru.dev@gmail.com", subject: "", body: "" };

const buildMailDataFromForm = () => {
  const name = contactForm.name.value.trim();
  const email = contactForm.email.value.trim();
  const message = contactForm.message.value.trim();
  const subject = translations[currentLang].mail_subject;
  const body = `${translations[currentLang].mail_body_name}: ${name}\n${translations[currentLang].mail_body_email}: ${email}\n\n${translations[currentLang].mail_body_message}:\n${message}`;
  return { to: "aaronbru.dev@gmail.com", subject, body };
};

const openMailPicker = (data) => {
  if (!mailPicker) {
    return;
  }
  mailData = data;
  mailPicker.classList.add("open");
  mailPicker.setAttribute("aria-hidden", "false");
  document.body.classList.add("lightbox-open");
};

const closeMailPicker = () => {
  if (!mailPicker) {
    return;
  }
  mailPicker.classList.remove("open");
  mailPicker.setAttribute("aria-hidden", "true");
  document.body.classList.remove("lightbox-open");
};

const openWebmail = (provider) => {
  const { to, subject, body } = mailData;
  const encodedTo = encodeURIComponent(to);
  const encodedSubject = encodeURIComponent(subject || "");
  const encodedBody = encodeURIComponent(body || "");
  let url = "";

  if (provider === "gmail") {
    url = `https://mail.google.com/mail/?view=cm&fs=1&to=${encodedTo}&su=${encodedSubject}&body=${encodedBody}`;
  } else if (provider === "outlook") {
    url = `https://outlook.live.com/mail/0/deeplink/compose?to=${encodedTo}&subject=${encodedSubject}&body=${encodedBody}`;
  }

  if (url) {
    window.open(url, "_blank", "noopener,noreferrer");
  }
  closeMailPicker();
};

const copyMailText = async () => {
  const { to, subject, body } = mailData;
  const text = `Para: ${to}\nAsunto: ${subject}\n\n${body}`;
  try {
    await navigator.clipboard.writeText(text);
  } catch (error) {
    window.prompt("Copiar mensaje:", text);
  }
};

if (contactForm) {
  contactForm.addEventListener("submit", (event) => {
    event.preventDefault();
    openMailPicker(buildMailDataFromForm());
  });
}

if (mailLink) {
  mailLink.addEventListener("click", (event) => {
    event.preventDefault();
    openMailPicker({ to: "aaronbru.dev@gmail.com", subject: "", body: "" });
  });
}

if (mailPicker) {
  mailPicker.querySelectorAll("[data-mail-close]").forEach((btn) => btn.addEventListener("click", closeMailPicker));
  mailPicker.querySelectorAll("[data-mail-open]").forEach((btn) => {
    btn.addEventListener("click", () => openWebmail(btn.dataset.mailOpen));
  });
  const copyBtn = mailPicker.querySelector("[data-mail-copy]");
  if (copyBtn) {
    copyBtn.addEventListener("click", copyMailText);
  }
  document.addEventListener("keydown", (event) => {
    if (!mailPicker.classList.contains("open")) {
      return;
    }
    if (event.key === "Escape") {
      closeMailPicker();
    }
  });
}

const lightbox = document.getElementById("lightbox");
if (lightbox) {
  const lightboxImage = document.getElementById("lightbox-image");
  const lightboxCaption = document.getElementById("lightbox-caption");
  const triggers = Array.from(document.querySelectorAll('[data-lightbox="stockarg"]'));
  const prevButton = lightbox.querySelector("[data-lightbox-prev]");
  const nextButton = lightbox.querySelector("[data-lightbox-next]");
  const closeButtons = lightbox.querySelectorAll("[data-lightbox-close]");
  const zoomButtons = lightbox.querySelectorAll("[data-lightbox-zoom]");
  const stage = lightbox.querySelector(".lightbox-stage");
  let currentIndex = 0;
  let zoom = 1;

  const clamp = (value, min, max) => Math.min(max, Math.max(min, value));

  const setZoom = (value) => {
    zoom = clamp(value, 1, 3);
    lightboxImage.style.transform = `scale(${zoom})`;
  };

  const updateImage = () => {
    const item = triggers[currentIndex];
    if (!item) {
      return;
    }
    lightboxImage.src = item.src;
    lightboxImage.alt = item.alt || "";
    lightboxCaption.textContent = item.dataset.caption || item.alt || "";
    setZoom(1);
  };

  const openLightbox = (index) => {
    currentIndex = index;
    updateImage();
    lightbox.classList.add("open");
    lightbox.setAttribute("aria-hidden", "false");
    document.body.classList.add("lightbox-open");
  };

  const closeLightbox = () => {
    lightbox.classList.remove("open");
    lightbox.setAttribute("aria-hidden", "true");
    document.body.classList.remove("lightbox-open");
    lightboxImage.src = "";
  };

  const showNext = (direction) => {
    if (!triggers.length) {
      return;
    }
    currentIndex = (currentIndex + direction + triggers.length) % triggers.length;
    updateImage();
  };

  triggers.forEach((img, index) => {
    const button = img.closest("button");
    const handler = () => openLightbox(index);
    if (button) {
      button.addEventListener("click", handler);
    } else {
      img.addEventListener("click", handler);
    }
  });

  if (prevButton) {
    prevButton.addEventListener("click", () => showNext(-1));
  }

  if (nextButton) {
    nextButton.addEventListener("click", () => showNext(1));
  }

  closeButtons.forEach((btn) => btn.addEventListener("click", closeLightbox));

  zoomButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const action = btn.dataset.lightboxZoom;
      if (action === "in") {
        setZoom(zoom + 0.2);
      } else if (action === "out") {
        setZoom(zoom - 0.2);
      } else {
        setZoom(1);
      }
    });
  });

  if (stage) {
    stage.addEventListener(
      "wheel",
      (event) => {
        if (!lightbox.classList.contains("open")) {
          return;
        }
        event.preventDefault();
        const delta = event.deltaY > 0 ? -0.1 : 0.1;
        setZoom(zoom + delta);
      },
      { passive: false }
    );
  }

  document.addEventListener("keydown", (event) => {
    if (!lightbox.classList.contains("open")) {
      return;
    }
    if (event.key === "Escape") {
      closeLightbox();
      return;
    }
    if (event.key === "ArrowRight") {
      showNext(1);
    }
    if (event.key === "ArrowLeft") {
      showNext(-1);
    }
  });
}
